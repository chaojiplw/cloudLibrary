<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itheima.dao.BookMapper">
    
    <resultMap id="bookMap" type="com.itheima.domain.Book">
        <id column="book_id" property="id"/>
        <result column="book_name" property="name"/>
        <result column="book_isbn" property="isbn"/>
        <result column="book_press" property="press"/>
        <result column="book_author" property="author"/>
        <result column="book_pagination" property="pagination"/>
        <result column="book_price" property="price"/>
        <result column="book_uploadtime" property="uploadTime"/>
        <result column="book_status" property="status"/>
        <result column="book_borrower" property="borrower"/>
        <result column="book_borrowtime" property="borrowTime"/>
        <result column="book_returntime" property="returnTime"/>
    </resultMap>

    <!-- 根据ID查询图书信息 -->
    <select id="findById" resultType="com.itheima.domain.Book">
        SELECT
            book_id as id,
            book_name as name,
            book_isbn as isbn,
            book_press as press,
            book_author as author,
            book_pagination as pagination,
            book_price as price,
            book_uploadtime AS uploadTime,
            book_status as status,
            book_borrower as borrower,
            book_borrowtime AS borrowTime,
            book_returntime AS returnTime
        FROM book
        WHERE book_id = #{id}
    </select>

    <!-- 根据上架时间查询最新上架的图书信息 -->
    <select id="selectNewBooks" resultType="com.itheima.domain.Book">
        SELECT
            book_id as id,
            book_name as name,
            book_isbn as isbn,
            book_press as press,
            book_author as author,
            book_pagination as pagination,
            book_price as price,
            book_uploadtime AS uploadTime,
            book_status as status,
            book_borrower as borrower,
            book_borrowtime AS borrowTime,
            book_returntime AS returnTime
        FROM book
        ORDER BY book_uploadtime DESC
            LIMIT 5
    </select>


    <!-- 更新图书信息（用于借阅图书） -->
    <update id="updateBook" parameterType="com.itheima.domain.Book">
        UPDATE book
        SET
            book_status = #{status},
            book_borrower = #{borrower},
            book_borrowtime = #{borrowTime},
            book_returntime = #{returnTime}
        WHERE book_id = #{id}
    </update>
    
    <!-- 新增图书 -->
    <insert id="addBook" parameterType="com.itheima.domain.Book">
        insert into book(
        book_id,book_name,book_isbn,book_press,book_author,
        book_pagination,book_price,book_uploadtime,book_status,
        book_borrower,book_borrowtime,book_returntime)
        values (#{id},#{name},#{isbn},#{press},#{author},#{pagination},
        #{price},#{uploadTime},#{status},#{borrower},#{borrowTime},#{returnTime})
    </insert>

</mapper>