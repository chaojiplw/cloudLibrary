<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itheima.dao.RecordMapper">
    
    <resultMap id="recordMap" type="com.itheima.domain.Record">
        <id column="record_id" property="id"/>
        <result column="record_bookname" property="bookname"/>
        <result column="record_bookisbn" property="bookisbn"/>
        <result column="record_borrower" property="borrower"/>
        <result column="record_borrowtime" property="borrowTime"/>
        <result column="record_remandtime" property="remandTime"/>
    </resultMap>
    
    <!-- 新增借阅记录 -->
    <insert id="addRecord" parameterType="com.itheima.domain.Record">
        INSERT INTO record (
            record_id,
            record_bookname,
            record_bookisbn,
            record_borrower,
            record_borrowtime,
            record_remandtime
        )
        VALUES (
            #{id},
            #{bookname},
            #{bookisbn},
            #{borrower},
            #{borrowTime},
            #{remandTime}
        )
    </insert>
    
    <!-- 分页查询借阅记录 -->
    <select id="searchRecords" parameterType="com.itheima.domain.Record" resultMap="recordMap">
        SELECT 
            record_id,
            record_bookname,
            record_bookisbn,
            record_borrower,
            record_borrowtime,
            record_remandtime
        FROM record
        <where>
            <if test="bookname != null and bookname != ''">
                AND record_bookname LIKE CONCAT('%', #{bookname}, '%')
            </if>
            <if test="borrower != null and borrower != ''">
                AND record_borrower LIKE CONCAT('%', #{borrower}, '%')
            </if>
        </where>
        ORDER BY record_remandtime DESC
    </select>
</mapper>